/* ************************************************************************** *//*                                                                            *//*                                                        :::      ::::::::   *//*   main.c                                             :+:      :+:    :+:   *//*                                                    +:+ +:+         +:+     *//*   By: desausag <desausag@student.42.fr>          +#+  +:+       +#+        *//*                                                +#+#+#+#+#+   +#+           *//*   Created: 2021/03/20 18:02:25 by desausag          #+#    #+#             *//*   Updated: 2021/04/11 15:12:27 by desausag         ###   ########.fr       *//*                                                                            *//* ************************************************************************** */#include "./game/ft_game.h"int		chs_pnt(t_all *all, t_cord ray, t_cord *cross, t_cord *dot_b){	t_cord	cross_x;	t_cord	b_x = {0, 1};	t_cord	b_y = {1, 0};	int		side;	cross_x = crc(ray, b_x, all->plr.pos, *dot_b);	*cross = crc(ray, b_y, all->plr.pos, *dot_b);	if (len_ray(all->plr.pos, cross_x) < len_ray(all->plr.pos, *cross))	{		side = 0;		*cross = cross_x;		*dot_b = fwd_pnt(ray, *dot_b, 1);	}	else	{		side = 1;		*dot_b = fwd_pnt(ray, *dot_b, -1);	}	return (side);}void	clc_pnt(t_all *all, t_cord ray, double *zbuf){	t_cord	cell;	t_cord	cross;	t_cord	dot_b;	int		side;	int		i;	i = -1;	while (++i < all->tx.width)	{		dot_b = net_point(ray, all->plr.pos);		cross = all->plr.pos;		while (!(is_wall_cord(all->map, cross, ray)))		{			side = chs_pnt(all, ray, &cross, &dot_b);			if ((cell = is_sprite(all->map, cross, ray)).x != -1)				init_sprite(all, cell);		}		zbuf[i] = print_wall(cross, all, v_int(i, side), ray);		ray = rttz(ray, 0, all->si_co);	}}void	draw_screen(t_all *all){	t_cord		ray;	double		zbuf[all->tx.width];	mlx_destroy_image(all->win.mlx, all->win.img);	init_img(all);	ray = rttz(all->plr.dir, -ANG / 2, all->si_co);	all->ray0 = ray;	null_sprites(all);	clc_pnt(all, ray, zbuf);	if (all->spr_co > 0)		print_sprite(all, zbuf);	if (all->save == 1)		screen_image(all);	mlx_put_image_to_window(all->win.mlx, all->win.mlx_win, all->win.img, 0, 0);}void	run(t_all *all){	all->win.mlx = mlx_init();	check_display_resolution(all);	all->win.mlx_win = mlx_new_window(all->win.mlx, all->tx.width,			all->tx.height, "Cub3d");	init_texture(all);	init_img(all);	all->si_co = v_set(cos(ANG * (M_PI / 180) / all->tx.width),			sin(ANG * (M_PI / 180) / all->tx.width));	draw_screen(all);	mlx_hook(all->win.mlx_win, 2, 1L << 0, key_hook, all);	mlx_hook(all->win.mlx_win, X, 1L << 0, exit, 0);	mlx_loop_hook(all->win.mlx, draw_screen, all);	mlx_loop(all->win.mlx);}int	main(int argc, char **argv){	t_tx		tx;	t_all			all;	if (argc == 1 && check_ext(argv[1]))		err("Error arguments\n");	if (argc == 3 && !(ft_strncmp(argv[2], "--save", 7)))		all.save = 1;	open_file(argv[1], &tx, &all);	run(&all);	return (0);}